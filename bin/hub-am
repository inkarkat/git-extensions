#!/bin/bash
shopt -qs extglob

printUsage()
{
    command hub am --help 2>&1 | sed \
	-e 's/<Maildir>/& | PR-URL | #ID/g'
}

typeset -a amArgs=()
while [ $# -ne 0 ]
do
    case "$1" in
	--help|-h|-\?)	shift; printUsage "$0"; exit 0;;
	\#+([0-9]))	prUrl="$(hub pr show --format '%U%n' "${1#\#}")" || exit $?; shift
			amArgs+=("$prUrl");;
	--)		amArgs+=("$1"); shift; break;;
	*)		amArgs+=("$1"); shift;;
    esac
done

exec hub am "${amArgs[@]}" "$@"
