#!/bin/bash
shopt -qs extglob

printUsage()
{
    command hub am --help 2>&1 | sed \
	-e 's/<Maildir>/& | PR-URL | #ID/g'
}

typeset -a amArgs=()
typeset -a prUrls=()
while [ $# -ne 0 ]
do
    case "$1" in
	--help|-h|-\?)	shift
			typeset -a pager=("${PAGER:-less}" --RAW-CONTROL-CHARS); [ -t 1 ] || pager=()
			eval 'printUsage "$0"' \ "${pager:+|}" '"${pager[@]}"'
			exit 0
			;;
	\#+([0-9]))	prUrl="$(hub pr show --format '%U%n' "${1#\#}")" || exit $?; shift
			prUrls+=("$prUrl");;
	--)		amArgs+=("$1"); shift; break;;
	*)		amArgs+=("$1"); shift;;
    esac
done

exec hub am "${amArgs[@]}" "${prUrls[@]}" "$@"
