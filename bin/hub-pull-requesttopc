#!/bin/bash

# DWIM: Add reference to a pull request of the previous cloned branch if such
# exists. I use cloned branches to build changes on top of each other, and these
# are then rebased and merged in turn.
previousClonedPr="$(git clonedbranch-command --offset -1 -3 prtitle --only-ids BRANCH)"
typeset -a pullrequestArgs=()
if [ -n "$previousClonedPr" ]; then
    contains --no-edit "$@" || pullrequestArgs+=(--edit)
    pullrequestArgs+=(--message "* Note: This is a follow-up on $previousClonedPr")
fi

exec git-rev-range-to-previous-clone --no-range --keep-position "${HUB_PULLREQUESTTO_COMMAND:-pull-request}" --base RANGE "${pullrequestArgs[@]}" "$@"
