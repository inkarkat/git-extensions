#!/bin/bash

readonly scriptDir="$([ "${BASH_SOURCE[0]}" ] && absoluteScriptFile="$(readlink -nf -- "${BASH_SOURCE[0]}")" && dirname -- "$absoluteScriptFile" || exit 3)"
[ -d "$scriptDir" ] || { echo >&2 'ERROR: Cannot determine script directory!'; exit 3; }

printUsage()
{
    cat <<HELPTEXT
Check whether all / passed branch variant scripts do a complete handling of
br... commands.
HELPTEXT
    echo
    printf 'Usage: %q %s\n' "$(basename "$1")" '[TYPE.sh ...] [-?|-h|--help]'
}

case "$1" in
    --help|-h|-\?)	shift; printUsage "$0"; exit 0;;
esac
if [ $# -eq 0 ]; then
    cd "$scriptDir" || exit 3
    set -- *.sh
fi

typeset -a gitCommands=(
d
ds
dss
dsta
dstat
dstatbyeach
dstabyeach
dl
dt
db
dw
dc
da
dy
dY
ad
adp
dr
drl
ma
logg
loggmine
loggv
loggvmine
lgg
lggmine
lcg
lcgmine
lclg
lclgmine
loggfiles
loggversions
loggtags
changedlog
changedlogmine
changedlogv
changedlogvmine
changedlg
changedlgmine
changedlc
changedlcmine
changedlcl
changedlclmine
changedfiles
changedversions
changedtags
touchedlog
touchedlogmine
touchedlogv
touchedlogvmine
touchedlg
touchedlgmine
touchedlc
touchedlcmine
touchedlcl
touchedlclmine
touchedfiles
touchedversions
touchedtags
loglastg
loglastgmine
loglastgv
loglastgvmine
showlastg
showlastgmine
showfileslastg
showversionlastg
showtaglastg
loglastchanged
loglastchangedmine
loglastchangedv
loglastchangedvmine
showlastchanged
showlastchangedmine
showfileslastchanged
showversionlastchanged
showtaglastchanged
loglasttouched
loglasttouchedmine
loglasttouchedv
loglasttouchedvmine
showlasttouched
showlasttouchedmine
showfileslasttouched
showversionlasttouched
showtaglasttouched
logfirstg
logfirstgmine
logfirstgv
logfirstgvmine
showfirstg
showfirstgmine
showfilesfirstg
showversionfirstg
showtagfirstg
logfirstchanged
logfirstchangedmine
logfirstchangedv
logfirstchangedvmine
showfirstchanged
showfirstchangedmine
showfilesfirstchanged
showversionfirstchanged
showtagfirstchanged
logfirsttouched
logfirsttouchedmine
logfirsttouchedv
logfirsttouchedvmine
showfirsttouched
showfirsttouchedmine
showfilesfirsttouched
showversionfirsttouched
showtagfirsttouched
lc
lcf
lcl
lclf
lcmine
lcteam
lcby
lcfmine
lcfteam
lcfby
lch
files
submodules
subdo
subchanges
superchanges
subrevdiff
subrevlog
subrevlg
subrevlc
st
ss
ssw
ssc
ssa
ssg
sschanged
sstouched
sls
slsg
slschanged
slstouched
dpls
dplg
dplss
dplsg
dplschanged
dplstouched
log
logf
logv
logfiles
inout
iofiles
iosubmodules
io
ab
glog
count
logbrowse
l
lo
logmod
logadded
logdeleted
logrenamed
logmodfiles
logaddedfiles
logdeletedfiles
logrenamedfiles
revive
lmine
lteam
lby
lg
lgx
lgf
lgv
lgrel
lgtagged
lgst
lgi
lgI
lh
lhmine
lhteam
lhby
lurl
lourl
luurl
lourlv
luurlv
treeurl
treeourl
treeuurl
treeourlv
treeuurlv
compareourl
compareuurl
lghi
lghipassedfiles
lghifiles
lghist
lghii
lghiI
lgmine
lgteam
lgby
logmine
logteam
logby
lgfilesmine
lgfilesteam
lgfilesby
cors
cops
revert
revertg
revertfiles
reverthunk
revertchanged
reverttouched
revertcommit
revertcommitg
revertcommitchanged
revertcommittouched
correct
correctg
correctchanged
correcttouched
correctst
correcti
correctI
fixup
fixupg
fixupchanged
fixuptouched
fixupst
fixupi
fixupI
fixamend
fixamendg
fixamendchanged
fixamendtouched
fixamendst
fixamendi
fixamendI
fixwording
fixwordingg
fixwordingchanged
fixwordingtouched
fixwordingst
fixwordingi
fixwordingI
fixuprb
fixamendrb
fixwordingrb
commitidentical
commitidenticalg
commitidenticalchanged
commitidenticaltouched
commitidenticalst
commitidenticali
commitidenticalI
commitlike
commitlikeg
commitlikechanged
commitliketouched
commitlikest
commitlikei
commitlikeI
commitrelate
commitrelateg
commitrelatechanged
commitrelatetouched
commitrelatest
commitrelatei
commitrelateI
amendrelate
amendrelateg
amendrelatechanged
amendrelatetouched
amendrelatest
amendrelatei
amendrelateI
rb
rbi
rbni
segregatecommits
segregateandbifurcate
bifurcate
rblastfixup
move-to-branch
uncommit-to-stash
uncommit-to-branch
createbr
stackbrfrom
detach
detachg
detachchanged
detachtouched
wipe
wipeg
wipechanged
wipetouched
base
baselg
bases
pred
predlg
preds
cat
cp
whocreatedthosechangedfiles
whocreatedhere
wholasttouchedthosechangedfiles
wholasttouchedhere
whodidthosechangedfiles
whodidhere
whodidfhere
whoownsthosechangedfiles
whoownshere
whocontributedthosechangedfiles
whocontributedhere
whowhatthosechangedfiles
whowhathere
whowhen
whofirst
wholast
whatdid
churn
activity
activitymine
activityteam
logdistribution
logdistributionmine
logdistributionteam
emaillog
emaillc
)

EXEC=:	# Don't execute handled commands.
scopeCommand='SCOPE-command'
for typeScript in "$@"
do
    for gitCommand in "${gitCommands[@]}"
    do (
	source "${scriptDir}/${typeScript}" "$gitCommand"
    ) done 2>&1 | withHeader --id "check-switch-completeness-$$-$RANDOM" -- "$typeScript"
done
